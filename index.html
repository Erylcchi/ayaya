<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Letter to Aya â€” From Eri</title>
<style>
/* Local Patrick Hand font (replace assets/patrick-hand.woff with real file) */
@font-face {
  font-family: 'PatrickHandLocal';
  src: url('assets/patrick-hand.woff') format('woff');
  font-weight: normal;
  font-style: normal;
  font-display: swap;
}
/* Fallback to Google Fonts if local not present (kept as fallback) */
@import url('https://fonts.googleapis.com/css2?family=Patrick+Hand&display=swap');

:root{
  --paper: #fff8ef;
  --ink: #233;
  --muted: #6b6b6b;
  --accent: #f7e9df;
  --maxwidth: 980px;
}
html,body{height:100%;margin:0;background:#f2efe9;font-family: 'PatrickHandLocal', 'Patrick Hand', -apple-system, system-ui, "Segoe UI", Roboto, Arial; color:var(--ink);}
.container{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;box-sizing:border-box;}
.shell{width:100%;max-width:var(--maxwidth);padding:22px;box-sizing:border-box;}
.stage{display:block;align-items:center;justify-content:center;}
/* loading screen */
.loading{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:url('assets/paper-texture.svg');background-size:cover;z-index:1000;transition:opacity .5s;}
.loading.hidden{opacity:0;pointer-events:none;}
.loading .text{font-size:28px;font-family:'PatrickHandLocal','Patrick Hand',sans-serif;color:var(--ink);background:rgba(255,255,255,0.6);padding:12px 18px;border-radius:10px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}

/* envelope */
.envelope-wrap{width:100%;display:flex;align-items:center;justify-content:center;position:relative;margin-top:6vh;margin-bottom:18px}
.envelope{width:100%;max-width:760px;height:220px;background:linear-gradient(180deg,#fff,#f7f1e8);border-radius:12px;display:flex;align-items:center;justify-content:center;box-shadow:0 12px 30px rgba(0,0,0,0.08);cursor:pointer;position:relative;overflow:hidden;transition:transform .22s;border:1px solid rgba(0,0,0,0.03)}
.envelope::before{content:'';position:absolute;left:50%;top:6px;transform:translateX(-50%);width:86%;height:60%;background:linear-gradient(180deg,#fff,#f3eadf);clip-path:polygon(0 0,50% 60%,100% 0,100% 100%,0 100%);border-radius:8px;transition:all .45s cubic-bezier(.2,.9,.2,1);box-shadow:inset 0 -1px 0 rgba(0,0,0,0.03)}
.envelope.open::before{transform:translateX(-50%) translateY(-110%) rotateX(12deg);opacity:0.99;}
.envelope-label{position:relative;z-index:2;font-size:22px;color:var(--ink);font-weight:400;letter-spacing:0.2px;text-align:center}
.envelope-label small{display:block;font-size:13px;color:var(--muted);font-family:Arial,Helvetica,sans-serif;margin-top:6px}

/* letter card */
.letter-container{display:flex;align-items:center;justify-content:center;flex-direction:column;}
.letter{width:100%;max-width:760px;background:var(--paper);border-radius:12px;padding:18px;box-shadow:0 12px 28px rgba(10,10,10,0.06);opacity:0;transform:translateY(12px);transition:all .45s ease;display:flex;flex-direction:column;overflow:hidden}
.letter.visible{opacity:1;transform:translateY(0)}

.paper-scroll{position:relative;overflow:hidden;border-radius:8px;background-image:linear-gradient(transparent 0 36px, rgba(0,0,0,0.02) 36px);}
.scroll-track{overflow-x:auto;white-space:nowrap;scroll-behavior:smooth;padding:22px 40px;min-height:320px;box-sizing:border-box;font-size:18px;line-height:1.6;font-family:'PatrickHandLocal','Patrick Hand',sans-serif}
.scroll-item{display:inline-block;vertical-align:top;white-space:normal;max-width:900px;padding-right:10px;}

/* fade edges */
.fade-left, .fade-right{position:absolute;top:0;bottom:0;width:64px;pointer-events:none;}
.fade-left{left:0;background:linear-gradient(90deg, var(--paper) 0%, rgba(255,255,255,0) 100%);}
.fade-right{right:0;background:linear-gradient(270deg, var(--paper) 0%, rgba(255,255,255,0) 100%);}

/* arrows always visible */
.arrows{position:relative;display:flex;gap:12px;align-items:center;justify-content:center;margin-top:12px}
.arrow-btn{width:46px;height:46px;border-radius:10px;border:1px solid rgba(0,0,0,0.06);background:rgba(255,255,255,0.9);box-shadow:0 8px 18px rgba(0,0,0,0.06);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:20px}
.arrow-btn:active{transform:translateY(1px)}

/* controls */
.controls{display:flex;gap:8px;margin-top:12px;align-items:center;}
.btn{background:#fff;border:1px solid rgba(0,0,0,0.06);padding:10px 12px;border-radius:10px;cursor:pointer;font-family:Arial,Helvetica,sans-serif;font-size:14px;box-shadow:0 6px 12px rgba(0,0,0,0.04);}

/* speaker toggle */
.speaker{position:fixed;right:18px;bottom:18px;background:rgba(255,255,255,0.92);border-radius:12px;padding:8px;box-shadow:0 6px 16px rgba(0,0,0,0.12);border:1px solid rgba(0,0,0,0.04);cursor:pointer;font-size:14px;display:flex;align-items:center;gap:8px;font-family:Arial,Helvetica,sans-serif}
.speaker.hidden{display:none}

/* responsive */
@media (max-width:740px){
  .envelope{height:160px}
  .scroll-track{padding:18px;min-height:220px;font-size:16px}
  .arrow-btn{width:44px;height:44px;font-size:18px}
  .loading .text{font-size:22px;padding:10px 14px}
}
</style>
</head>
<body>
<div class="loading" id="loading">
  <div class="text">Sealed with care</div>
</div>

<div class="container" id="main" aria-hidden="true">
  <div class="shell">
    <div class="stage">
      <div class="envelope-wrap">
        <div class="envelope front" id="envelope" role="button" tabindex="0" aria-label="Open letter to Aya">
          <div class="envelope-label"><div style="font-size:20px;">To: Aya</div><small style="opacity:0.9">Tap to open</small></div>
        </div>
      </div>

      <div class="letter-container">
        <div class="letter" id="letter" aria-hidden="true">
          <div class="paper-scroll" style="position:relative;">
            <div class="scroll-track" id="scrollTrack" tabindex="0" role="region" aria-label="Letter text">
              <div class="scroll-item" id="scrollItem">
Dear Aya,
[Write your opening line here...]
[Write what youâ€™ve been meaning to say to Aya...]
[Closing thoughts or message...]
With all my heart,
Eri
              </div>
            </div>
            <div class="fade-left"></div>
            <div class="fade-right"></div>
          </div>

          <div class="arrows" style="margin-top:14px;">
            <button class="arrow-btn" id="leftArrow" aria-label="Scroll left">â—€</button>
            <button class="arrow-btn" id="rightArrow" aria-label="Scroll right">â–¶</button>
          </div>

          <div class="controls">
            <button class="btn" id="copyBtn">Copy</button>
            <button class="btn" id="printBtn">Print / Save PDF</button>
            <button class="btn" id="resetBtn">Reset</button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="speaker hidden" id="speakerToggle" title="Toggle background music" aria-hidden="true">
  <span id="speakerIcon">ðŸ”Š</span><span style="font-size:13px;color:#444">Music</span>
</div>

<!-- YouTube IFrame API -->
<script src="https://www.youtube.com/iframe_api"></script>
<script>
  const loading = document.getElementById('loading');
  const main = document.getElementById('main');
  const envelope = document.getElementById('envelope');
  const letter = document.getElementById('letter');
  const scrollTrack = document.getElementById('scrollTrack');
  const leftArrow = document.getElementById('leftArrow');
  const rightArrow = document.getElementById('rightArrow');
  const speakerToggle = document.getElementById('speakerToggle');
  const speakerIcon = document.getElementById('speakerIcon');
  const copyBtn = document.getElementById('copyBtn');
  const printBtn = document.getElementById('printBtn');
  const resetBtn = document.getElementById('resetBtn');

  // show loading ~1s then reveal envelope
  window.addEventListener('load', ()=>{
    setTimeout(()=>{
      loading.classList.add('hidden');
      main.setAttribute('aria-hidden','false');
    }, 900);
  });

  // envelope open behavior
  let opened = false;
  const VIDEO_ID = '4KzrdHXMzuo';
  const START_DELAY = 1000;
  const DEFAULT_VOLUME = 25;
  let player = null;
  let musicOn = true;

  function openEnvelope(){
    if(opened) return;
    opened = true;
    envelope.classList.add('open');
    // hide envelope after animation
    setTimeout(()=> envelope.style.display = 'none', 450);
    // reveal letter
    setTimeout(()=>{
      letter.classList.add('visible');
      letter.setAttribute('aria-hidden','false');
    }, 260);
    // start music after delay (user gesture)
    setTimeout(()=>{
      if(player){ player.setVolume(DEFAULT_VOLUME); player.playVideo(); speakerToggle.classList.remove('hidden'); speakerToggle.setAttribute('aria-hidden','false'); }
    }, START_DELAY + 400);
  }

  envelope.addEventListener('click', openEnvelope);
  envelope.addEventListener('keypress', (e)=>{ if(e.key==='Enter' || e.key===' ') openEnvelope(); });

  // YouTube Player API
  function onYouTubeIframeAPIReady(){
    const div = document.createElement('div');
    div.id = 'ytplayer';
    div.style.width='0'; div.style.height='0'; div.style.position='absolute'; div.style.left='-9999px';
    document.body.appendChild(div);
    player = new YT.Player('ytplayer', {
      height: '0', width: '0',
      videoId: VIDEO_ID,
      playerVars: {
        autoplay: 0, controls: 0, rel: 0, modestbranding: 1, playsinline: 1, loop: 1, playlist: VIDEO_ID
      },
      events: {
        'onReady': (e)=>{ try{ e.target.setVolume(0); }catch(e){} },
        'onStateChange': (e)=>{
          // keep looping if ended (loop param should handle, but ensure)
          if(e.data === YT.PlayerState.ENDED){ if(player) player.playVideo(); }
        }
      }
    });
  }

  // speaker toggle
  speakerToggle.addEventListener('click', ()=>{
    if(!player) return;
    if(musicOn){ player.pauseVideo(); speakerIcon.textContent='ðŸ”‡'; musicOn=false; }
    else{ player.setVolume(DEFAULT_VOLUME); player.playVideo(); speakerIcon.textContent='ðŸ”Š'; musicOn=true; }
  });

  // scroll arrows behavior
  const SCROLL_AMOUNT = 400; // pixels per click (adjustable)
  leftArrow.addEventListener('click', ()=>{ scrollTrack.scrollBy({left:-SCROLL_AMOUNT,behavior:'smooth'}); });
  rightArrow.addEventListener('click', ()=>{ scrollTrack.scrollBy({left:SCROLL_AMOUNT,behavior:'smooth'}); });

  // make arrows work with touch/keyboard accessibility
  leftArrow.addEventListener('keydown',(e)=>{ if(e.key==='Enter') leftArrow.click(); });
  rightArrow.addEventListener('keydown',(e)=>{ if(e.key==='Enter') rightArrow.click(); });

  // always show arrows; but add subtle hover effect
  [leftArrow,rightArrow].forEach(btn=>{
    btn.addEventListener('mouseover', ()=> btn.style.transform='scale(1.03)');
    btn.addEventListener('mouseout', ()=> btn.style.transform='scale(1)');
  });

  // copy / print / reset
  copyBtn.addEventListener('click', async ()=>{
    try{ await navigator.clipboard.writeText(document.getElementById('scrollItem').innerText); copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy',1200); }catch(e){ alert('Copy failed'); }
  });
  printBtn.addEventListener('click', ()=> window.print());
  resetBtn.addEventListener('click', ()=>{
    if(!confirm('Reset letter content to placeholders?')) return;
    document.getElementById('scrollItem').innerText = "Dear Aya,\\n[Write your opening line here...]\\n[Write what youâ€™ve been meaning to say to Aya...]\\n[Closing thoughts or message...]\\nWith all my heart,\\nEri";
    scrollTrack.scrollLeft = 0;
  });

  // accessibility: allow keyboard scrolling with arrows when focused
  scrollTrack.addEventListener('keydown', (e)=>{
    if(e.key === 'ArrowRight') rightArrow.click();
    if(e.key === 'ArrowLeft') leftArrow.click();
  });

</script>
</body>
</html>
